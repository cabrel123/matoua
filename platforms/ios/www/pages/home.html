<template>
  <div class="page page-home">
    <div class="navbar navbar-large navbar-transparent">
      <div class="navbar-bg"></div>
      <div class="navbar-inner navbar-inner-centered-title">
        <div class="left">
          <a class="link icon-only panel-open" data-panel="left">
            <i class="icon f7-icons if-not-md">menu</i>
            <i class="icon material-icons md-only">menu</i>
          </a>
        </div>
        <div class="center">
          <span class="title">MAT<span class="green">OUA</span></span>
        </div>
        <div class="right">
          <a class="link icon-only searchbar-enable" href="/find-a-ride/">
            <i class="icon f7-icons if-not-md">search</i>
            <i class="icon material-icons md-only">search</i>
          </a>
        </div>
      </div>
    </div>
    <div class="page-content">
      <div class="list-strong inset list-dividers-ios searchbar-hide-on-search">
        <h1 class="text-center searchbar-found padding">
          Un vaste choix de trajets à petits prix
        </h1>
        <div
          class="list list-strong-ios list-outline-ios list-dividers-ios form-store-data"
          id="demo-form"
        >
          <ul class="findrideList">
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Départ <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select
                        name="departure"
                        id="find-departure-2"
                        type="text"
                        class="townList"
                        required
                      >
                        <option value="">Choisir</option>
                      </select>
                    </div>
                  </div>
                </li>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Destination <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select
                        name="destination"
                        id="find-destination-2"
                        type="text"
                        class="townList2"
                        required
                      >
                        <option value="">Choisir</option>
                      </select>
                    </div>
                  </div>
                </li>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Date de départ <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap">
                      <input
                        type="text"
                        placeholder=""
                        readonly="readonly"
                        id="find-departureDate-2"
                        name="departureDate"
                        required
                      />
                    </div>
                  </div>
                </li>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Nb. de passagers <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select
                        name="numberofSeats"
                        placeholder="Please choose..."
                        id="numberofSeats-2"
                        required
                      >
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                      </select>
                    </div>
                  </div>
                </li>
              </div>
            </div>
          </ul>
          <div class="block">
            <a
              class="button button-raised button-large button-fill findrideBtn button-round color-black"
              @click="${findRide}"
            >
              Rechercher</a
            >
          </div>
        </div>
        <div
          class="bg-green list list-strong list-outline-ios list-dividers-ios inset-md accordion-list"
        >
          <h1 class="text-center searchbar-found">
            Comment fonctionne MATOUA ?
          </h1>
          <ul>
            <li class="accordion-item">
              <a class="item-link item-content">
                <div class="item-inner">
                  <div class="item-title">Pour commencer</div>
                </div>
              </a>
              <div class="accordion-item-content">
                <div class="block">
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Aenean elementum id neque nec commodo. Sed vel justo at
                    turpis laoreet pellentesque quis sed lorem. Integer semper
                    arcu nibh, non mollis arcu tempor vel. Sed pharetra tortor
                    vitae est rhoncus, vel congue dui sollicitudin. Donec eu
                    arcu dignissim felis viverra blandit suscipit eget ipsum.
                  </p>
                </div>
              </div>
            </li>
            <li class="accordion-item">
              <a class="item-link item-content">
                <div class="item-inner">
                  <div class="item-title">
                    À propos des frais de service de covoiturage
                  </div>
                </div>
              </a>
              <div class="accordion-item-content">
                <div class="block">
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Aenean elementum id neque nec commodo. Sed vel justo at
                    turpis laoreet pellentesque quis sed lorem. Integer semper
                    arcu nibh, non mollis arcu tempor vel. Sed pharetra tortor
                    vitae est rhoncus, vel congue dui sollicitudin. Donec eu
                    arcu dignissim felis viverra blandit suscipit eget ipsum.
                  </p>
                </div>
              </div>
            </li>
            <li class="accordion-item">
              <a class="item-link item-content">
                <div class="item-inner">
                  <div class="item-title">
                    Comment fonctionne le covoiturage ?
                  </div>
                </div>
              </a>
              <div class="accordion-item-content">
                <div class="block">
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Aenean elementum id neque nec commodo. Sed vel justo at
                    turpis laoreet pellentesque quis sed lorem. Integer semper
                    arcu nibh, non mollis arcu tempor vel. Sed pharetra tortor
                    vitae est rhoncus, vel congue dui sollicitudin. Donec eu
                    arcu dignissim felis viverra blandit suscipit eget ipsum.
                  </p>
                </div>
              </div>
            </li>
          </ul>
        </div>
        <h1 class="text-center searchbar-found">N'attendez plus !</h1>
        <div class="bg-color-green block-outline-ios block-strong padding">
          <p class="grid grid-cols-2 grid-gap">
            <a
              href="/find-a-ride/"
              class="button button-large button-round button-fill color-black"
              >Trouver un trajet</a
            >
            <a
              href="/publish-ride/"
              class="button button-active button-large button-raised button-round color-white"
              >Publier un trajet</a
            >
          </p>
        </div>
      </div>
    </div>
  </div>
</template>
<style>
  .img-responsive {
    margin: 0 auto;
    display: block;
    max-width: 200px;
  }

  .page-home .navbar-inner .link .icon {
    color: var(
      --f7-navbar-link-color,
      var(--f7-bars-link-color, var(--f7-theme-color))
    );
  }
  .page-home .navbar.navbar-large-collapsed .icon {
    color: #ffffff !important;
  }
  .page-home .page-content {
    padding-top: 34px;
  }
  .text-center {
    text-align: center;
  }

  .page-home .title {
    font-size: 30px !important;
    font-weight: 600 !important;
    color: black !important;
  }
  .page-home .navbar-large-collapsed .title {
    color: #fff !important;
  }
  .page-home .navbar-large .title {
    opacity: 1;
  }
  .page-home .title .green {
    color: #0fc874;
  }
  .page-home .navbar-large-collapsed .title .green {
    color: #044025;
  }

  .list .item-subtitle {
    white-space: normal;
    text-align: justify;
  }
  .page-home .card {
    box-shadow: none !important;
  }

  .color-red {
    color: #c0000a;
  }
  .color-gray {
    color: #dbe2f9;
  }
  .page-home .list ul {
    border-radius: 20px;
  }
</style>
<script>
  export default (props, { $f7, $, $on }) => {
    let calendarModal;

    $on("pageInit", () => {
      $f7.dialog.close();
      // Custom modal
      calendarModal = $f7.calendar.create({
        inputEl: "#find-departureDate-2",
        openIn: "customModal",
        header: true,
        footer: true,
      });
    });

    // Specify the API endpoint for user data
    const apiUrl = "https://matoua.com/api/town";
    let content = "";
    let content2 = "";
    let data = [];

    // Make a GET request using the Fetch API
    fetch(apiUrl)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((town) => {
        // Process the retrieved user data
        //console.log("town Data:", town);
        var content = "";
        var content2 = "";
        var maxRow = town.length;

        var i = "";
        content += '<option value="">';
        content += "Départ";
        content += "</option>";
        content2 += '<option value="">';
        content2 += "Destination";
        content2 += "</option>";
        for (i = 0; i < maxRow; i++) {
          content +=
            '<option value="' +
            town[i]["town_id"] +
            "-" +
            town[i]["town_name"] +
            '">';
          content += "" + town[i]["town_name"] + "";
          content += "</option>";
          content += "<br/>";
        }

        $(".townList").append(content);
        $(".townList2").append(content2 + content);
      })
      .catch((error) => {
        console.error("Error:", error);
      });

    const findRide = () => {
      let departure = $("#find-departure-2").val().split("-")[0];
      let departureName = $("#find-departure-2").val().split("-")[1];
      let destination = $("#find-destination-2").val().split("-")[0];
      let destinationName = $("#find-destination-2").val().split("-")[1];
      let departureDate = $("#find-departureDate-2").val();
      let numberofSeats = $("#numberofSeats-2").val();

      if (
        departure == "" ||
        destination == "" ||
        departureDate == "" ||
        numberofSeats == ""
      ) {
        app.dialog.alert("Veuillez renseigner tous les champs SVP !");
      } else {
        $f7.dialog.preloader("Un instant svp...");
        localStorage.setItem("departure", departure);
        localStorage.setItem("departureName", departureName);
        localStorage.setItem("destination", destination);
        localStorage.setItem("destinationName", destinationName);
        localStorage.setItem("departureDate", departureDate);
        localStorage.setItem("numberofSeats", numberofSeats);
        setTimeout(function () {
          $f7.dialog.close();
          var mainView = app.view.main;
          mainView.router.navigate("/rider-list/");
        }, 2000);
      }
    };

    $on("pageBeforeRemove", () => {
      calendarModal.destroy();
    });

    return $render;
  };
</script>

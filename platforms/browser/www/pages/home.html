<template>
  <div class="page page-home">
    <div class="navbar navbar-large navbar-transparent">
      <div class="navbar-bg"></div>
      <div class="navbar-inner navbar-inner-centered-title">
        <div class="left">
          <a class="link icon-only panel-open" data-panel="left">
            <i class="icon f7-icons if-not-md">menu</i>
            <i class="icon material-icons md-only">menu</i>
          </a>
        </div>
        <div class="center">
          <span class="title logo-name">MAT<span class="green">OUA</span></span>
		  <br/>
		  <span class="text-center welcome" style="display:none">Bienvenue, <span class="user-fullname"></span></span>
        </div>
        <div class="right">
          <a class="link icon-only searchbar-enable" href="/find-a-ride/">
            <i class="icon f7-icons if-not-md">search</i>
            <i class="icon material-icons md-only">search</i>
          </a>
        </div>
      </div>
    </div>
    <div class="page-content">
      <div class="list-strong inset list-dividers-ios searchbar-hide-on-search">
        <h1 class="text-center searchbar-found padding">
          Un vaste choix de trajets à <span class="green">petits prix !</span>
        </h1>
        <!-- <div
          class="list list-strong-ios list-outline-ios list-dividers-ios form-store-data"
          id="demo-form"
        >
          <ul class="findrideList">
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Départ <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select
                        name="departure"
                        id="find-departure-2"
                        type="text"
                        class="townList"
                        required
                      >
                        <option value="">Choisir</option>
                      </select>
                    </div>
                  </div>
                </li>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Destination <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select
                        name="destination"
                        id="find-destination-2"
                        type="text"
                        class="townList2"
                        required
                      >
                        <option value="">Choisir</option>
                      </select>
                    </div>
                  </div>
                </li>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Date de départ <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap">
                      <input
                        type="text"
                        placeholder=""
                        readonly="readonly"
                        id="find-departureDate-2"
                        name="departureDate"
                        required
                      />
                    </div>
                  </div>
                </li>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">
                      Nb. de passagers <span class="color-red">*</span>
                    </div>
                    <div class="item-input-wrap input-dropdown-wrap">
                      <select
                        name="numberofSeats"
                        placeholder="Please choose..."
                        id="numberofSeats-2"
                        required
                      >
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                      </select>
                    </div>
                  </div>
                </li>
              </div>
            </div>
          </ul>
          <div class="block">
            <a
              class="button button-raised button-large button-fill findrideBtn button-round color-black"
              @click="${findRide}"
            >
              Rechercher</a
            >
          </div>
        </div> -->
        
        <!-- <h1 class="text-center searchbar-found">N'attendez plus !</h1> -->
        <div class="block-outline-ios block-strong padding">
          <p class="row margin-30">
            <a
              href="/find-a-ride/"
              class="button button-large button-round button-block button-fill color-black font-size-22"
              ><i class="icon f7-icons if-not-md">search</i>
            <i class="icon material-icons md-only">search</i> Trouver un trajet</a
            >
            
          </p>
		  <p class="row margin-30">
            
            <a
              href="/publish-ride/"
              class="button button-active button-large button-raised button-block button-round color-white font-size-22"
              ><i class="icon f7-icons if-not-md">location</i>
            <i class="icon material-icons md-only">send</i> Publier un trajet</a
            >
          </p>
        </div>
      </div>
    </div>
  </div>
</template>
<style>
  .img-responsive {
    margin: 0 auto;
    display: block;
    max-width: 200px;
  }
  
  .page-home{background:#fff}

  .page-home .navbar-inner .link .icon {
    color: var(
      --f7-navbar-link-color,
      var(--f7-bars-link-color, var(--f7-theme-color))
    );
  }
  .page-home .navbar.navbar-large-collapsed .icon {
    color: #ffffff !important;
  }

  .text-center {
    text-align: center;
  }
  
  .margin-30{
  margin-top:30px;
  margin-bottom:30px
  }
  
  .font-size-22{font-size:22px}

  .page-home .title {
    font-size: 30px !important;
    font-weight: 600 !important;
    color: black !important;
  }
  .page-home .page-content h1{
    font-size: 32px;
  }
  .page-home .page-content .block-strong{
    background:#fff
  }
  .page-home .navbar-large-collapsed .title {
    color: #fff !important;
  }
  .page-home .navbar-large .title {
    opacity: 1;
  }
  .page-home .green {
    color: #0fc874;
  }
  .page-home .navbar-large-collapsed .title .green {
    color: #044025;
  }

  .list .item-subtitle {
    white-space: normal;
    text-align: justify;
  }
  .page-home .card {
    box-shadow: none !important;
  }

  .color-red {
    color: #c0000a;
  }
  .color-gray {
    color: #dbe2f9;
  }
  .page-home .list ul {
    border-radius: 20px;
  }
  .padding-left-25{padding-left:25px}
</style>
<script>
  export default (props, { $f7, $, $on }) => {
    let calendarModal;

    $on("pageInit", () => {
      $f7.dialog.close();
      // Custom modal
     /* calendarModal = $f7.calendar.create({
        inputEl: "#find-departureDate-2",
        openIn: "customModal",
        header: true,
        footer: true,
      });*/
	  const token = localStorage.getItem("token");
	  const fullname = localStorage.getItem("fullname");
	  if(token == '' || token == null || token == 'undefined'){
		$(".welcome").hide();
		$(".logo-name").removeClass('padding-left-25');
	  }else{
	  $(".welcome").show();
	  $(".logo-name").addClass('padding-left-25');
	  $(".user-fullname").html(fullname);
	  }

      
    });

    // Specify the API endpoint for user data
/*     const apiUrl = "https://matoua.com/api/town";
    let content = "";
    let content2 = "";
    let data = [];

    // Make a GET request using the Fetch API
    fetch(apiUrl)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((town) => {
        // Process the retrieved user data
        //console.log("town Data:", town);
        var content = "";
        var content2 = "";
        var maxRow = town.length;

        var i = "";
        content += '<option value="">';
        content += "Départ";
        content += "</option>";
        content2 += '<option value="">';
        content2 += "Destination";
        content2 += "</option>";
        for (i = 0; i < maxRow; i++) {
          content +=
            '<option value="' +
            town[i]["town_id"] +
            "-" +
            town[i]["town_name"] +
            '">';
          content += "" + town[i]["town_name"] + "";
          content += "</option>";
          content += "<br/>";
        }

        $(".townList").append(content);
        $(".townList2").append(content2 + content);
      })
      .catch((error) => {
        console.error("Error:", error);
      }); */

    const findRide = () => {
      let departure = $("#find-departure-2").val().split("-")[0];
      let departureName = $("#find-departure-2").val().split("-")[1];
      let destination = $("#find-destination-2").val().split("-")[0];
      let destinationName = $("#find-destination-2").val().split("-")[1];
      let departureDate = $("#find-departureDate-2").val();
      let numberofSeats = $("#numberofSeats-2").val();

      if (
        departure == "" ||
        destination == "" ||
        departureDate == "" ||
        numberofSeats == ""
      ) {
        app.dialog.alert("Veuillez renseigner tous les champs SVP !");
      } else {
        $f7.dialog.preloader("Un instant svp...");
        localStorage.setItem("departure", departure);
        localStorage.setItem("departureName", departureName);
        localStorage.setItem("destination", destination);
        localStorage.setItem("destinationName", destinationName);
        localStorage.setItem("departureDate", departureDate);
        localStorage.setItem("numberofSeats", numberofSeats);
        setTimeout(function () {
          $f7.dialog.close();
          var mainView = app.view.main;
          mainView.router.navigate("/rider-list/");
        }, 2000);
      }
    }; 

    $on("pageBeforeRemove", () => {
      calendarModal.destroy();
    });

    return $render;
  };
</script>
